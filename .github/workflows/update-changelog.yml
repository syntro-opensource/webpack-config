name: Update changelog
on:
  push:
    branches: [ master ]
    paths-ignore:
      - CHANGELOG.md
jobs:
  update-changelog:
    runs-on: ubuntu-latest
    steps:
    - name: checkout
      uses: actions/checkout@v2
      with:
        ref: master
    # - name: generate changelog
    #   uses: docker://ferrarimarco/github-changelog-generator
    #   run: >-
    #     --token ${{ secrets.GITHUB_TOKEN }}
    #     --user $(echo "$GITHUB_REPOSITORY" | cut -d / -f 1 )
    #     --project $(echo "$GITHUB_REPOSITORY" | cut -d / -f 2- )
      # run: |
      #
    - name: generate changelog
      uses: heinrichreimer/github-changelog-generator-action@v2.1.1
      with:
        token: ${{ secrets.GITHUB_TOKEN }}
        output: CHANGELOG.md
        releaseBranch: master
        pullRequests: true
        unreleased: true
        sinceTag: 1.0.4
        breakingLabel: 💥Breaking
        enhancementLabel: 🍰Enhancements
        bugsLabel: 🐞Bugs
        deprecatedLabel: 💀Deprecated
        removedLabel: 🗑Removed
        securityLabel: 🛡Security
        addSections: '{"dependencies":{"prefix":"**🕸Dependencies:**","labels":["dependencies"]}}'
    - name: push
      uses: github-actions-x/commit@v2.7
      with:
        github-token: ${{ secrets.GITHUB_TOKEN }}
        push-branch: 'master'
        commit-message: 'Update Changelog'
        force-add: 'true'
        files: CHANGELOG.md
        name: ChangelogBot
